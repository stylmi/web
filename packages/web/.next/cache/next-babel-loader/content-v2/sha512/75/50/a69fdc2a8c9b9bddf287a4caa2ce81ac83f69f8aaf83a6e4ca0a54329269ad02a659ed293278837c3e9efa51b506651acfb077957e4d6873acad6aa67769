{"ast":null,"code":"import _regeneratorRuntime from \"/Users/mrcea/Desktop/Nunua/template/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/mrcea/Desktop/Nunua/template/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/mrcea/Desktop/Nunua/template/packages/web/containers/Search/Categories/index.js\",\n    _s = $RefreshSig$();\n\nimport React, { Fragment, useState, useContext } from 'react';\nimport { CategoryListCard } from '../../../components/CategoryCard';\nimport { CategoryLoader } from '../../../components/Placeholder';\nimport { useQuery } from '@apollo/react-hooks';\nimport { GET_SEARCH_CATEGORY } from 'core/graphql/Search.query';\nimport { SearchContext } from '../../../contexts/SearchContext';\nimport { addOrRemove, inArray } from '../../../helpers';\nimport { setStateToUrl, getUrlToState } from '../../../helpers/urlHandler';\nimport ListGrid from 'reusecore/src/elements/ListGrid';\nimport OnError from '../../../components/OnError';\n\nfunction SearchCategory() {\n  _s();\n\n  var _this = this;\n\n  var urlState = getUrlToState();\n\n  var _useState = useState(false),\n      loadingMore = _useState[0],\n      toggleLoading = _useState[1];\n\n  var _useState2 = useState(1),\n      page = _useState2[0],\n      paginate = _useState2[1];\n\n  var _useContext = useContext(SearchContext),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch;\n\n  var QUERY_VARIABLES = {\n    LIMIT: 6\n  };\n\n  var _useQuery = useQuery(GET_SEARCH_CATEGORY, {\n    variables: QUERY_VARIABLES\n  }),\n      data = _useQuery.data,\n      loading = _useQuery.loading,\n      error = _useQuery.error,\n      fetchMore = _useQuery.fetchMore;\n\n  if (error) return /*#__PURE__*/_jsxDEV(OnError, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 24,\n    columnNumber: 21\n  }, this); // if (loading) return null;\n\n  var allCategories = data && data.categories && data.categories.data ? data.categories.data : [];\n  var categoryCount = data && data.categories && data.categories.length ? data.categories.length : 1;\n  var total = data && data.categories && data.categories.total ? data.categories.total : 1;\n\n  var handleCategorySelection = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(slug) {\n      var selectedCategories;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return addOrRemove(slug, state.categories);\n\n            case 2:\n              selectedCategories = _context.sent;\n              setStateToUrl({\n                categories: selectedCategories\n              });\n              dispatch({\n                type: 'UPDATE',\n                payload: {\n                  categories: selectedCategories\n                }\n              });\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleCategorySelection(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: /*#__PURE__*/_jsxDEV(ListGrid, {\n      data: allCategories,\n      totalPost: total,\n      postCount: allCategories.length,\n      columnWidth: [1],\n      component: function component(item) {\n        return /*#__PURE__*/_jsxDEV(CategoryListCard, {\n          title: item.name,\n          selected: inArray(item.slug, urlState.categories),\n          postNumber: \"\".concat(item.posts.total, \" posts\"),\n          source: item.image ? item.image.url : '',\n          style: {\n            paddingLeft: 30,\n            paddingRight: 20\n          },\n          handleClick: function handleClick() {\n            return handleCategorySelection(item.slug);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 13\n        }, _this);\n      },\n      loading: loading ? loading : loadingMore,\n      buttonVariant: \"textButton\",\n      loadMoreButtonStyle: {\n        color: '#595959',\n        textDecoration: 'none !important'\n      },\n      placeholder: /*#__PURE__*/_jsxDEV(CategoryLoader, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 22\n      }, this),\n      limit: QUERY_VARIABLES.LIMIT,\n      componentWrapperStyle: {\n        ml: 0,\n        mr: 0,\n        mb: 20\n      },\n      componentContainerStyle: {\n        pl: 0,\n        pr: 0\n      },\n      loadMoreWrapperStyle: {\n        width: '100%',\n        flexBox: true,\n        flexDirection: 'row',\n        justifyContent: 'center',\n        pt: '5px',\n        pb: '5px',\n        borderTop: '1px solid #e2e2e2'\n      },\n      handleLoadMore: function handleLoadMore(loading) {\n        toggleLoading(true);\n        paginate(page + 1);\n        fetchMore({\n          variables: {\n            page: page + 1\n          },\n          updateQuery: function updateQuery(prev, _ref2) {\n            var fetchMoreResult = _ref2.fetchMoreResult;\n\n            if (!fetchMoreResult) {\n              toggleLoading(false);\n              return prev;\n            }\n\n            var oldPosts = prev.categories.data;\n            var newPosts = fetchMoreResult.categories.data;\n            console.log('before everything');\n\n            if (categoryCount && total) {\n              console.log('called');\n\n              if (categoryCount <= total) {\n                console.log('called 1');\n                toggleLoading(false);\n                var concatedPosts = oldPosts.concat(newPosts);\n                fetchMoreResult.categories.data = concatedPosts;\n                return fetchMoreResult;\n              }\n            }\n          }\n        });\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 51,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SearchCategory, \"ZpIXBAC85pwXP2NPanWOHZqS4As=\", false, function () {\n  return [useQuery];\n});\n\n_c = SearchCategory;\nexport default SearchCategory;\n\nvar _c;\n\n$RefreshReg$(_c, \"SearchCategory\");","map":{"version":3,"sources":["/Users/mrcea/Desktop/Nunua/template/packages/web/containers/Search/Categories/index.js"],"names":["React","Fragment","useState","useContext","CategoryListCard","CategoryLoader","useQuery","GET_SEARCH_CATEGORY","SearchContext","addOrRemove","inArray","setStateToUrl","getUrlToState","ListGrid","OnError","SearchCategory","urlState","loadingMore","toggleLoading","page","paginate","state","dispatch","QUERY_VARIABLES","LIMIT","variables","data","loading","error","fetchMore","allCategories","categories","categoryCount","length","total","handleCategorySelection","slug","selectedCategories","type","payload","item","name","posts","image","url","paddingLeft","paddingRight","color","textDecoration","ml","mr","mb","pl","pr","width","flexBox","flexDirection","justifyContent","pt","pb","borderTop","updateQuery","prev","fetchMoreResult","oldPosts","newPosts","console","log","concatedPosts","concat"],"mappings":"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","sourcesContent":["import React, { Fragment, useState, useContext } from 'react';\nimport { CategoryListCard } from '../../../components/CategoryCard';\nimport { CategoryLoader } from '../../../components/Placeholder';\nimport { useQuery } from '@apollo/react-hooks';\nimport { GET_SEARCH_CATEGORY } from 'core/graphql/Search.query';\nimport { SearchContext } from '../../../contexts/SearchContext';\nimport { addOrRemove, inArray } from '../../../helpers';\nimport { setStateToUrl, getUrlToState } from '../../../helpers/urlHandler';\nimport ListGrid from 'reusecore/src/elements/ListGrid';\nimport OnError from '../../../components/OnError';\n\nfunction SearchCategory() {\n  const urlState = getUrlToState();\n  const [loadingMore, toggleLoading] = useState(false);\n  const [page, paginate] = useState(1);\n  const { state, dispatch } = useContext(SearchContext);\n  let QUERY_VARIABLES = {\n    LIMIT: 6,\n  };\n\n  const { data, loading, error, fetchMore } = useQuery(GET_SEARCH_CATEGORY, {\n    variables: QUERY_VARIABLES,\n  });\n  if (error) return <OnError />;\n  // if (loading) return null;\n  const allCategories =\n    data && data.categories && data.categories.data ? data.categories.data : [];\n  const categoryCount =\n    data && data.categories && data.categories.length\n      ? data.categories.length\n      : 1;\n  const total =\n    data && data.categories && data.categories.total\n      ? data.categories.total\n      : 1;\n\n  const handleCategorySelection = async slug => {\n    const selectedCategories = await addOrRemove(slug, state.categories);\n    setStateToUrl({\n      categories: selectedCategories,\n    });\n\n    dispatch({\n      type: 'UPDATE',\n      payload: {\n        categories: selectedCategories,\n      },\n    });\n  };\n  return (\n    <Fragment>\n      <ListGrid\n        data={allCategories}\n        totalPost={total}\n        postCount={allCategories.length}\n        columnWidth={[1]}\n        component={item => {\n          return (\n            <CategoryListCard\n              title={item.name}\n              selected={inArray(item.slug, urlState.categories)}\n              postNumber={`${item.posts.total} posts`}\n              source={item.image ? item.image.url : ''}\n              style={{ paddingLeft: 30, paddingRight: 20 }}\n              handleClick={() => handleCategorySelection(item.slug)}\n            />\n          );\n        }}\n        loading={loading ? loading : loadingMore}\n        buttonVariant=\"textButton\"\n        loadMoreButtonStyle={{\n          color: '#595959',\n          textDecoration: 'none !important',\n        }}\n        placeholder={<CategoryLoader />}\n        limit={QUERY_VARIABLES.LIMIT}\n        componentWrapperStyle={{\n          ml: 0,\n          mr: 0,\n          mb: 20,\n        }}\n        componentContainerStyle={{\n          pl: 0,\n          pr: 0,\n        }}\n        loadMoreWrapperStyle={{\n          width: '100%',\n          flexBox: true,\n          flexDirection: 'row',\n          justifyContent: 'center',\n          pt: '5px',\n          pb: '5px',\n          borderTop: '1px solid #e2e2e2',\n        }}\n        handleLoadMore={loading => {\n          toggleLoading(true);\n          paginate(page + 1);\n          fetchMore({\n            variables: {\n              page: page + 1,\n            },\n            updateQuery: (prev, { fetchMoreResult }) => {\n              if (!fetchMoreResult) {\n                toggleLoading(false);\n                return prev;\n              }\n              const oldPosts = prev.categories.data;\n              const newPosts = fetchMoreResult.categories.data;\n              console.log('before everything');\n              if (categoryCount && total) {\n                console.log('called');\n                if (categoryCount <= total) {\n                  console.log('called 1');\n                  toggleLoading(false);\n                  const concatedPosts = oldPosts.concat(newPosts);\n                  fetchMoreResult.categories.data = concatedPosts;\n                  return fetchMoreResult;\n                }\n              }\n            },\n          });\n        }}\n      />\n    </Fragment>\n  );\n}\n\nexport default SearchCategory;\n"]},"metadata":{},"sourceType":"module"}